<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Apple Privacy Profile Generator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1em;
      background-color: #f0f2f5;
      color: #333;
    }
    input, select, textarea, button {
      padding: 12px;
      margin: 8px 0;
      width: 100%;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 1em;
    }
    button {
      background-color: #007aff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #005ecb;
    }
    .section {
      background: white;
      padding: 1em;
      border-radius: 8px;
      box-shadow: 0 0 8px rgba(0,0,0,0.1);
      margin-bottom: 2em;
    }
    @media (max-width: 600px) {
      body {
        margin: 0.5em;
      }
    }
  </style>
</head>
<body>
  <h1>ðŸ“± Privacy Profile Generator</h1>

  <div class="section">
    <label>Profile Name:</label>
    <input type="text" id="profileName" value="My Privacy Profile" />

    <label>Payload UUID (optional):</label>
    <input type="text" id="uuid" />

    <label>Website Filter Mode:</label>
    <select id="filterMode">
      <option value="blacklistedURLs">Block (Blacklist)</option>
      <option value="whitelistedURLs">Allow Only (Whitelist)</option>
    </select>

    <label>Websites (one per line):</label>
    <textarea id="sites" rows="4" placeholder="https://example.com"></textarea>

    <label>Block System Apps:</label>
    <select multiple id="blockedApps">
      <option value="allowSafari">Safari</option>
      <option value="allowCamera">Camera</option>
      <option value="allowFaceTime">FaceTime</option>
      <option value="allowAppInstallation">App Installation</option>
      <option value="allowAccountModification">Account Modification</option>
      <option value="allowAirDrop">AirDrop</option>
      <option value="allowiCloudDocuments">iCloud Drive</option>
    </select>

    <label>Wi-Fi SSID (optional):</label>
    <input type="text" id="wifiSSID" />

    <label>Wi-Fi Password:</label>
    <input type="password" id="wifiPassword" />
  </div>

  <button onclick="generateProfile()">Generate & Download Profile</button>

  <script>
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        const r = Math.random() * 16 | 0,
              v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function generateProfile() {
      const profileName = document.getElementById('profileName').value.trim();
      const uuid = document.getElementById('uuid').value || generateUUID();
      const filterMode = document.getElementById('filterMode').value;
      const sites = document.getElementById('sites').value.trim().split('\n').map(s => s.trim()).filter(Boolean);
      const blockedAppValues = Array.from(document.getElementById('blockedApps').selectedOptions).map(opt => opt.value);
      const wifiSSID = document.getElementById('wifiSSID').value.trim();
      const wifiPassword = document.getElementById('wifiPassword').value.trim();

      const payloads = [];

      // âœ… Website Filtering Payload
      const accessControlPayload = {
        PayloadType: "com.apple.applicationaccess",
        PayloadIdentifier: "com.example.webblock",
        PayloadUUID: generateUUID(),
        PayloadVersion: 1,
        PayloadDisplayName: "Web Filtering",
        allowWebBrowserAccess: false
      };
      accessControlPayload[filterMode] = sites;
      payloads.push(accessControlPayload);

      // âœ… System/App Restrictions Payload
      if (blockedAppValues.length > 0) {
        const restrictionsPayload = {
          PayloadType: "com.apple.applicationaccess",
          PayloadIdentifier: "com.example.appblock",
          PayloadUUID: generateUUID(),
          PayloadVersion: 1,
          PayloadDisplayName: "App Restrictions"
        };
        blockedAppValues.forEach(key => {
          restrictionsPayload[key] = false;
        });
        payloads.push(restrictionsPayload);
      }

      // âœ… Optional Wi-Fi Payload
      if (wifiSSID && wifiPassword) {
        payloads.push({
          PayloadType: "com.apple.wifi.managed",
          SSID_STR: wifiSSID,
          HiddenNetwork: false,
          AutoJoin: true,
          EncryptionType: "WPA",
          Password: wifiPassword,
          PayloadDisplayName: "Wi-Fi Config",
          PayloadIdentifier: "com.example.wifi",
          PayloadUUID: generateUUID(),
          PayloadVersion: 1
        });
      }

      // âœ… Wrap final profile
      const profile = {
        PayloadType: "Configuration",
        PayloadVersion: 1,
        PayloadIdentifier: "com.example." + uuid.slice(0, 8),
        PayloadUUID: uuid,
        PayloadDisplayName: profileName,
        PayloadContent: payloads
      };

      const xml = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
 "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
${convertToXML(profile)}
</plist>`;

      const blob = new Blob([xml], { type: 'application/x-apple-aspen-config' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = profileName.replace(/\s+/g, '_').toLowerCase() + ".mobileconfig";
      a.click();
    }

    function convertToXML(obj, indent = '  ') {
      if (typeof obj !== 'object' || obj === null) return '';
      let xml = '<dict>\n';
      for (const key in obj) {
        const val = obj[key];
        xml += indent + `<key>${key}</key>\n`;
        if (typeof val === 'string') {
          xml += indent + `<string>${val}</string>\n`;
        } else if (typeof val === 'number') {
          xml += indent + `<integer>${val}</integer>\n`;
        } else if (typeof val === 'boolean') {
          xml += indent + `<${val}/>\n`;
        } else if (Array.isArray(val)) {
          xml += indent + `<array>\n`;
          val.forEach(item => {
            xml += indent + indent + `<string>${item}</string>\n`;
          });
          xml += indent + `</array>\n`;
        } else if (typeof val === 'object') {
          xml += indent + convertToXML(val, indent + '  ') + '\n';
        }
      }
      xml += '</dict>';
      return xml;
    }
  </script>
</body>
</html>
