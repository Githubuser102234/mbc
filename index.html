<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MobileConfig Profile Generator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 1em;
      background-color: #f4f4f4;
      color: #333;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px #ccc;
    }
    h1 {
      color: #007aff;
      font-size: 1.5em;
      margin-bottom: 1em;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input, textarea, button {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    button {
      margin-top: 20px;
      background-color: #007aff;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #005bb5;
    }
    .note {
      font-size: 0.9em;
      color: #888;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>MobileConfig Generator</h1>

    <label>Profile Name</label>
    <input type="text" id="profileName" value="My Profile">

    <label>Wi-Fi SSID (optional)</label>
    <input type="text" id="wifiSSID" placeholder="MyWiFi">

    <label>Wi-Fi Password (optional)</label>
    <input type="password" id="wifiPassword" placeholder="password123">

    <div class="note">
      Website blocking and app restrictions are not included (only allowed on supervised devices).
    </div>

    <button onclick="generateProfile()">Download Profile</button>
  </div>

  <script>
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
        const r = Math.random() * 16 | 0;
        const v = c === 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function generateProfile() {
      const profileName = document.getElementById('profileName').value;
      const wifiSSID = document.getElementById('wifiSSID').value.trim();
      const wifiPassword = document.getElementById('wifiPassword').value.trim();

      const payloads = [];

      if (wifiSSID && wifiPassword) {
        payloads.push({
          PayloadType: "com.apple.wifi.managed",
          SSID_STR: wifiSSID,
          HiddenNetwork: false,
          AutoJoin: true,
          EncryptionType: "WPA",
          Password: wifiPassword,
          PayloadDisplayName: "Wi-Fi Config",
          PayloadIdentifier: "com.example.wifi",
          PayloadUUID: generateUUID(),
          PayloadVersion: 1
        });
      }

      const profile = {
        PayloadType: "Configuration",
        PayloadVersion: 1,
        PayloadIdentifier: "com.example." + generateUUID().slice(0, 8),
        PayloadUUID: generateUUID(),
        PayloadDisplayName: profileName,
        PayloadContent: payloads
      };

      const xml = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN"
 "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
${convertToXML(profile)}
</plist>`;

      const blob = new Blob([xml], { type: 'application/x-apple-aspen-config' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = profileName.replace(/\s+/g, '_').toLowerCase() + ".mobileconfig";
      a.click();
    }

    function convertToXML(obj, indent = '  ') {
      if (typeof obj !== 'object' || obj === null) return '';
      let xml = '<dict>\n';
      for (const key in obj) {
        const val = obj[key];
        xml += indent + `<key>${key}</key>\n`;
        if (typeof val === 'string') {
          xml += indent + `<string>${val}</string>\n`;
        } else if (typeof val === 'number') {
          xml += indent + `<integer>${val}</integer>\n`;
        } else if (typeof val === 'boolean') {
          xml += indent + `<${val}/>\n`;
        } else if (Array.isArray(val)) {
          xml += indent + `<array>\n`;
          val.forEach(item => {
            if (typeof item === 'string') {
              xml += indent + indent + `<string>${item}</string>\n`;
            } else {
              xml += indent + indent + convertToXML(item, indent + '  ') + '\n';
            }
          });
          xml += indent + `</array>\n`;
        } else if (typeof val === 'object') {
          xml += indent + convertToXML(val, indent + '  ') + '\n';
        }
      }
      xml += '</dict>';
      return xml;
    }
  </script>
</body>
</html>
